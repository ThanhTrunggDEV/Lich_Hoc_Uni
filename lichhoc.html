<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thời Khóa Biểu</title>
  <link rel="stylesheet" href="superstyle.css">
  <style>
    :root {
      --primary-color: #6200ee;
      --primary-dark: #3700b3;
      --primary-light: #bb86fc;
      --secondary-color: #03dac6;
      --surface-color: #ffffff;
      --background-color: #f6f6f6;
      --error-color: #b00020;
      --text-primary: #212121;
      --text-secondary: #757575;
      --text-on-primary: #ffffff;
      --border-radius: 16px;
      --shadow: 0 4px 6px rgba(0,0,0,0.1);
      --transition: all 0.3s ease;
    }
    
    .dark-mode {
  --primary-color: #44365c;
  --primary-dark: #363042;
  --primary-light: #BB86FC;
  --secondary-color: #03DAC6;
  --surface-color: #1E1E1E;
  --background-color: #121212;
  --error-color: #CF6679;
  --text-primary: rgb(4, 181, 240);
  --text-secondary: rgba(255, 255, 255, 0.8);
  --text-on-primary: #000000;
  --border-radius: 16px;
  --shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
  --transition: all 0.3s ease;
  --border: rgba(255, 255, 255, 0.12);
  --checkbox-color: #03DAC6;
  --accent-surface: rgba(74, 144, 226, 0.15);
}
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      background-color: var(--background-color);
      color: var(--text-primary);
      padding: 0;
      margin: 0;
      padding-bottom: 60px;
      line-height: 1.6;
    }
    

    .app-container {
      max-width: 800px;
      margin: 0 auto;
      background-color: var(--surface-color);
      border-radius: 0 0 var(--border-radius) var(--border-radius);
      box-shadow: var(--shadow);
      min-height: 100vh;
      overflow: hidden;
    }
    
    

    .header {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: var(--text-on-primary);
      padding: 24px 16px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      border-radius: 0;
    }
    
    .header h1 {
      text-align: center;
      font-size: 1.8rem;
      font-weight: 500;
      margin: 8px 0;
      letter-spacing: 0.5px;
    }
    
    .header-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-top: 5px;
      letter-spacing: 0.5px;
    }
    
    .header-actions {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 800px;
      padding: 0 10px;
      margin-top: 16px;
    }
    
    .header-icon {
      background-color: rgba(255, 255, 255, 0.2);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      cursor: pointer;
    }
    
    .header-icon:hover {
      background-color: rgba(255, 255, 255, 0.3);
      transform: scale(1.05);
    }
    
    .container {
      padding: 0;
    }
    
    .schedule-container {
      padding: 15px 20px;
    }
    
    .week-header {
      background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
      padding: 15px;
      margin: 16px 0 12px 0;
      border-radius: var(--border-radius);
      font-weight: 500;
      color: var(--text-on-primary);
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
    }
    
    .week-header i {
      margin-right: 10px;
      font-size: 1.1rem;
    }
    
    .day-container {
      margin-bottom: 24px;
    }
    
    .day-title {
      background-color: var(--surface-color);
      padding: 12px 15px;
      margin-bottom: 12px;
      border-radius: var(--border-radius);
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary-color);
    }
    
    .day-title.today {
      background-color: #ede7f6;
      border-left: 4px solid var(--secondary-color);
    }
    
    .day-title span:first-child {
      font-size: 1rem;
      font-weight: 600;
    }
    
    .day-title span:last-child {
      background-color: var(--primary-color);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
    }
    
    .schedule-item {
      background-color: var(--surface-color);
      border-radius: var(--border-radius);
      margin-bottom: 16px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border-bottom: 1px solid #eee;
    }
    
    .schedule-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    
    .schedule-item.free {
      background: linear-gradient(135deg, #FF9800, #F57C00);
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 1.2rem;
      font-weight: 500;
    }
    
    .schedule-item.weekend {
      background: linear-gradient(135deg, #9C27B0, #7B1FA2);
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 1.2rem;
      font-weight: 500;
    }
    
    .schedule-item.class {
      position: relative;
    }
    
    .class-time {
      padding: 14px 15px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f8f9fa;
    }
    
    .time-text {
      font-weight: 500;
      color: var(--primary-color);
    }
    
    .class-status {
      display: flex;
      align-items: center;
      background-color: #e8f5e9;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      color: #2e7d32;
    }
    
    .class-status i {
      margin-left: 5px;
    }
    
    .class-details {
      padding: 16px;
    }
    
    .class-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--primary-light);
    }
    
    .class-info {
      margin-bottom: 12px;
      display: flex;
      align-items: flex-start;
    }
    
    .class-info:last-child {
      margin-bottom: 0;
    }
    
    .info-icon {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      font-size: 0.8rem;
    }
    
    .no-class-card {
      background: linear-gradient(135deg, #f5f5f5, #eeeeee);
      border-radius: var(--border-radius);
      padding: 20px;
      text-align: center;
      font-weight: 500;
      color: #757575;
      box-shadow: var(--shadow);
      border-left: 4px solid #9e9e9e;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .no-class-card i {
      font-size: 2rem;
      margin-bottom: 10px;
      color: #9e9e9e;
    }
    
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 200px;
      font-size: 1rem;
      color: var(--text-secondary);
    }
    
    .loading i {
      font-size: 2rem;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    
    .error-message {
      background-color: var(--error-color);
      color: white;
      padding: 20px;
      border-radius: var(--border-radius);
      margin: 15px 0;
      text-align: center;
      box-shadow: var(--shadow);
    }
    
    .error-message i {
      font-size: 2rem;
      margin-bottom: 10px;
      display: block;
    }
    
    /* Thêm CSS cho modal donate */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal-content {
      background: var(--surface-color, #fff);
      border-radius: 16px;
      padding: 32px 24px 24px 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
      max-width: 350px;
      width: 90%;
      text-align: center;
      position: relative;
      animation: modalFadeIn 0.2s;
    }
    .modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      cursor: pointer;
      color: #888;
      font-size: 1.2rem;
      transition: color 0.2s;
    }
    .modal-close:hover {
      color: var(--primary-color, #6200ee);
    }
    .modal-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 16px;
    }
    .qr-image {
      width: 180px;
      height: 250px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 12px;
      border: 2px solid #eee;
      background: #fafafa;
    }
    .modal-description {
      margin-top: 10px;
      color: var(--text-secondary, #757575);
      font-size: 0.95rem;
    }
    @keyframes modalFadeIn {
      from { transform: translateY(40px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @media (max-width: 600px) {
      .header h1 {
        font-size: 1.5rem;
      }
      
      .day-title {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .day-title span:last-child {
        margin-top: 5px;
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="app-container">
    <div class="header">
      <h1>Lịch Học Cá Nhân</h1>
      <div class="header-subtitle">Have a good day</div>
      <div class="header-actions">
        <div class="header-icon" id="change-mode-button"><i class="fas fa-sun"></i></div>
        <div class="header-icon" id="refresh-button"><i class="fas fa-sync-alt"></i></div>
      </div>
      <button class="donate-button" id="donate-button">
        <i class="fas fa-heart"></i> Donate
      </button>
    </div>
    
    <div class="container">
      <div id="loading" class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <div>Đang tải thông tin lịch học...</div>
      </div>
      <div class="schedule-container" id="schedule-container">
      </div>
    </div>
  </div>
  
  
  <div class="modal-overlay" id="donate-modal">
    <div class="modal-content">
      <div class="modal-close" id="modal-close"><i class="fas fa-times"></i></div>
      <h3 class="modal-title">Cảm ơn bạn đã ủng hộ!</h3>
      <img src="https://api.vietqr.io/image/970422-015062005-AZvwQuX.jpg?accountName=NGUYEN%20THANH%20TRUNG&amount=5000&addInfo=donate" alt="QR Code" class="qr-image" id="qr-code">
      <p>Quét mã QR để chuyển tiền</p>
      <div class="modal-description">
        Mọi sự đóng góp đều giúp mình duy trì và phát triển ứng dụng này
      </div>
    </div>
  </div>
 
   

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      

      const donateButton = document.getElementById('donate-button');
      const donateModal = document.getElementById('donate-modal');
      const modalClose = document.getElementById('modal-close');
      
      donateButton.addEventListener('click', function() {
        donateModal.classList.add('active');
        
      });
      
      modalClose.addEventListener('click', function() {
        donateModal.classList.remove('active');
      });
      
      
      donateModal.addEventListener('click', function(e) {
        if (e.target === donateModal) {
          donateModal.classList.remove('active');
        }
      });

      function formatVietnameseDay(dayNumber) {
        const days = ['Chủ Nhật', 'Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7'];
        return days[dayNumber];
      }

      function vietnameseDayToNumber(vietDay) {
        const dayMap = {'Chủ Nhật': 0, 'Thứ 2': 1, 'Thứ 3': 2, 'Thứ 4': 3, 'Thứ 5': 4, 'Thứ 6': 5, 'Thứ 7': 6};
        return dayMap[vietDay] || 0;
      }

      const today = new Date();
      const currentDay = today.getDay(); 

      function formatTimeRange(start, end) {
        return `${start} - ${end}`;
      }

      const periodTimes = {
        1: { start: '6:45', end: '7:35' },
        2: { start: '7:40', end: '8:30' },
        3: { start: '8:40', end: '9:30' },
        4: { start: '9:40', end: '10:30' },
        5: { start: '10:35', end: '11:25' },
        6: { start: '13:00', end: '13:50' },
        7: { start: '13:55', end: '14:45' },
        8: { start: '14:55', end: '15:45' },
        9: { start: '15:55', end: '16:45' },
        10: { start: '16:50', end: '17:40' },
        11: { start: '18:15', end: '19:05' },
        12: { start: '19:10', end: '20:00' },
        13: { start: '20:05', end: '20:55' },
        14: { start: '20:20', end: '21:10' },
        15: { start: '21:20', end: '22:10' }
      };

      function transformTimetableData(data) {
        const schedule = {};
        function numericDayToVietnameseDay(numDay) {
          const dayMap = {
            '1': 'Chủ Nhật', '2': 'Thứ 2', '3': 'Thứ 3', '4': 'Thứ 4', 
            '5': 'Thứ 5', '6': 'Thứ 6', '7': 'Thứ 7'
          };
          return dayMap[numDay] || numDay; 
        }
        
        function parsePeriodRange(periodStr) {
          if (periodStr.includes('-->')) {
            const parts = periodStr.split('-->').map(p => p.trim());
            return {
              firstPeriod: parseInt(parts[0]),
              lastPeriod: parseInt(parts[1])
            };
          } else if (periodStr.includes(',')) {
            const parts = periodStr.split(',').map(p => p.trim());
            return {
              firstPeriod: parseInt(parts[0]),
              lastPeriod: parseInt(parts[parts.length - 1])
            };
          } else {
            const period = parseInt(periodStr.trim());
            return {
              firstPeriod: period,
              lastPeriod: period
            };
          }
        }
        
        Object.keys(data).forEach(week => {
          if (!schedule[week]) {
            schedule[week] = {
              'Thứ 2': [], 'Thứ 3': [], 'Thứ 4': [], 'Thứ 5': [], 'Thứ 6': [], 'Thứ 7': [], 'Chủ Nhật': []
            };
          }
          
          data[week].forEach(session => {

            const vietDay = numericDayToVietnameseDay(session.day);
            
            let startTime = '';
            let endTime = '';
            
            const { firstPeriod, lastPeriod } = parsePeriodRange(session.period);
            
            startTime = periodTimes[firstPeriod]?.start || '';
            endTime = periodTimes[lastPeriod]?.end || '';
            
            if (!schedule[week][vietDay]) {
              console.warn(`Day ${vietDay} not found in schedule for week ${week}, creating it`);
              schedule[week][vietDay] = [];
            }
            
            schedule[week][vietDay].push({
              ...session,
              day: vietDay, 
              startTime,
              endTime
            });
          });
          
  
          Object.keys(schedule[week]).forEach(day => {
            if (Array.isArray(schedule[week][day])) {
              schedule[week][day].sort((a, b) => {
                const { firstPeriod: aFirstPeriod } = parsePeriodRange(a.period);
                const { firstPeriod: bFirstPeriod } = parsePeriodRange(b.period);
                return aFirstPeriod - bFirstPeriod;
              });
            }
          });
        });
        
        return schedule;
      }

      function isLower(char){
        return char === char.toLowerCase() && char !== char.toUpperCase();
      }

      function createClassCard(classItem) {
        const classDiv = document.createElement('div');
        classDiv.className = 'schedule-item class';
        
        const timeDiv = document.createElement('div');
        timeDiv.className = 'class-time';
        
        const timeText = document.createElement('div');
        timeText.className = 'time-text';
        timeText.innerHTML = `<i class="far fa-clock"></i> ${formatTimeRange(classItem.startTime, classItem.endTime)}`;
        
        const classStatus = document.createElement('div');
        classStatus.className = 'class-status';
        classStatus.innerHTML = 'Lịch học <i class="fas fa-check-circle"></i>';
        
        timeDiv.appendChild(timeText);
        timeDiv.appendChild(classStatus);
        classDiv.appendChild(timeDiv);
        
        const detailsDiv = document.createElement('div');
        detailsDiv.className = 'class-details';
        
        const titleDiv = document.createElement('div');
        titleDiv.className = 'class-title';
        titleDiv.textContent = classItem.subject;
        detailsDiv.appendChild(titleDiv);
        
        const teacherInfo = document.createElement('div');
        teacherInfo.className = 'class-info';
        let teacherName = classItem.teacher;
        for(let i = 0; i < teacherName.length - 1; i++){
            if(teacherName[i] == '\n' && isLower(teacherName[i + 1])){
                teacherName = teacherName.slice(0, i + 1);
                break;
            }
        }
        teacherInfo.innerHTML = `<div class="info-icon"><i class="fas fa-user"></i></div> Giảng viên: ${teacherName}`;
        detailsDiv.appendChild(teacherInfo);
        
        const periodInfo = document.createElement('div');
        periodInfo.className = 'class-info';
        periodInfo.innerHTML = `<div class="info-icon"><i class="fas fa-list-ol"></i></div> Tiết: ${classItem.period}`;
        detailsDiv.appendChild(periodInfo);
        
        const roomInfo = document.createElement('div');
        roomInfo.className = 'class-info';
        roomInfo.innerHTML = `<div class="info-icon"><i class="fas fa-door-open"></i></div> Phòng: ${classItem.room}`;
        detailsDiv.appendChild(roomInfo);
        
        classDiv.appendChild(detailsDiv);
        return classDiv;
      }

      function createEmptyDayCard() {
        const emptyDiv = document.createElement('div');
        emptyDiv.className = 'no-class-card';
        emptyDiv.innerHTML = '<i class="fas fa-coffee"></i> Không Phải Đi Học !!!';
        return emptyDiv;
      }
      
      function showError(message, details) {
        const scheduleContainer = document.getElementById('schedule-container');
        const loadingElement = document.getElementById('loading');
        
        if (loadingElement) {
          loadingElement.style.display = 'none';
        }
        
        if (scheduleContainer) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'error-message';
          errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i><div>${message}</div>`;
          
          if (details) {
            const detailsElement = document.createElement('div');
            detailsElement.style.marginTop = '10px';
            detailsElement.style.fontSize = '0.8rem';
            detailsElement.textContent = `Chi tiết lỗi: ${details}`;
            errorDiv.appendChild(detailsElement);
          }
          
          scheduleContainer.appendChild(errorDiv);
        }
      }

      function isWeekInPast(weekText) {
        const endDateMatch = weekText.match(/đến (\d{2})\/(\d{2})\/(\d{4})/);
        if (!endDateMatch) return false;
        
        const endDay = parseInt(endDateMatch[1]);
        const endMonth = parseInt(endDateMatch[2]) - 1; 
        const endYear = parseInt(endDateMatch[3]);
        
        const weekEndDate = new Date(endYear, endMonth, endDay);
        const today = new Date();
        
        today.setHours(0, 0, 0, 0);

        return weekEndDate < today;
      }

      async function renderFullTimetable() {
        const scheduleContainer = document.getElementById('schedule-container');
        const loadingElement = document.getElementById('loading');
        
        if (!scheduleContainer || !loadingElement) {
          console.error('Required DOM elements not found!');
          return;
        }
        
        scheduleContainer.innerHTML = '';
        
        try {
            let data;
            const studentID = localStorage.getItem('studentID');
            const password = localStorage.getItem('password');
            
            const response = await fetch(`https://api.nguyenthanhtrung.online/download?username=${studentID}&password=${password}`, {
              method: 'GET',
              headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
              }
            });
            
            
            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(`Status: ${response.status}, Message: ${errorText}`);
            }
            
            data = await response.json();
          
          loadingElement.style.display = 'none';
          
          const currentAndFutureWeeks = {};
          Object.keys(data).forEach(week => {
            if (!isWeekInPast(week)) {
              currentAndFutureWeeks[week] = data[week];
            }
          });
          
          if (Object.keys(currentAndFutureWeeks).length === 0) {
            showError("Không có lịch học cho thời gian sắp tới", "Tất cả lịch học đã kết thúc");
            return;
          }
          
          const schedule = transformTimetableData(currentAndFutureWeeks);
          
          const sortedWeeks = Object.keys(schedule).sort((a, b) => {
            const matchA = a.match(/Tuần (\d+):/);
            const matchB = b.match(/Tuần (\d+):/);

            const weekNumberA = matchA ? parseInt(matchA[1]) : 0;
            const weekNumberB = matchB ? parseInt(matchB[1]) : 0;

            return weekNumberA - weekNumberB;
          });
          
          
        
         sortedWeeks.forEach(week => {
            const weekHeader = document.createElement('div');
            weekHeader.className = 'week-header';
            weekHeader.innerHTML = `<i class="far fa-calendar-alt"></i> ${week}`;
            scheduleContainer.appendChild(weekHeader);
            
            let isCurrentWeek = false;
            let daysOfWeek = new Array();
            let daysOfWeekToCompare = new Array();
            let dateRangeMatch = week.match(/(\d{2})\/(\d{2})\/(\d{4}) đến (\d{2})\/(\d{2})\/(\d{4})/);
            const allNumbers = dateRangeMatch.slice(1).map(num => parseInt(num));
            
            const startDay = allNumbers[0];
            const startMonth = allNumbers[1] - 1; 
            const startYear = allNumbers[2];
                
            const endDay = allNumbers[3];
            const endMonth = allNumbers[4] - 1;
            const endYear = allNumbers[5];
                 
            const startDate = new Date(startYear, startMonth, startDay);
            const endDate = new Date(endYear, endMonth, endDay);
            endDate.setHours(23, 59, 59, 999); 

            let tempStartDate = new Date(startDate);
            let tempEndDate = new Date(endDate);

            while(tempStartDate <= tempEndDate){
              daysOfWeekToCompare.push(tempStartDate.toDateString());
              let day = tempStartDate.getDate().toString().padStart(2, '0');
              let month = (tempStartDate.getMonth() + 1).toString();
              daysOfWeek.push(day + " Tháng " + month);
              tempStartDate.setDate(tempStartDate.getDate() + 1);
              
            }

            const today = new Date();
            
            if (today >= startDate && today <= endDate) {
                  isCurrentWeek = true;
                  console.log(`Đã tìm thấy tuần hiện tại: ${week}`);
             }
              
            
            const orderedDays = ['Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7', 'Chủ Nhật'];
            let countDay = 0;
            let countDay2 = 0;
            orderedDays.forEach(day => {
              const dayClasses = schedule[week][day];
              const todayVietDay = formatVietnameseDay(today.getDay());
              
              
              if (new Date(daysOfWeekToCompare[countDay2++]) >= new Date(today.toDateString())) {
              const dayContainer = document.createElement('div');
              dayContainer.className = 'day-container';
              const dayTitle = document.createElement('div');
              dayTitle.className = 'day-title';
              
              if (isCurrentWeek && todayVietDay === day) {
                dayTitle.classList.add('today');
              }
              
              dayTitle.innerHTML = `<span>${day} Ngày ${daysOfWeek[countDay]}</span>`;
              
              if (isCurrentWeek && todayVietDay === day) {
                dayTitle.innerHTML += `<span>Hôm nay</span>`;
              }
              
              dayContainer.appendChild(dayTitle);
              if (dayClasses.length === 0) {
                dayContainer.appendChild(createEmptyDayCard());
              } else {
                dayClasses.forEach(classItem => {
                  dayContainer.appendChild(createClassCard(classItem));
                });
              }
              scheduleContainer.appendChild(dayContainer);
              }
              countDay++;   
            });
          });
          
        } catch (error) {
          console.error("Error fetching timetable:", error);
          showError("Không thể tải lịch học", error.message);
        }
      }

      try {   
        renderFullTimetable();
        
        const refreshButton = document.getElementById('refresh-button');
        if (refreshButton) {
          refreshButton.addEventListener('click', () => {
            const loadingElement = document.getElementById('loading');
            const scheduleContainer = document.getElementById('schedule-container');
            
            if (loadingElement && scheduleContainer) {
              loadingElement.style.display = 'block';
              scheduleContainer.innerHTML = '';
              renderFullTimetable();
            }
          });
        } else {
          console.error("Refresh button not found!");
        }
      } catch (initError) {
        console.error("Error during initialization:", initError);
        showError("Lỗi khởi tạo ứng dụng", initError.message);
      }
      
      const changeModeButton = document.getElementById('change-mode-button');
      let isDarkMode = false;
      changeModeButton.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        if(isDarkMode === false){
          isDarkMode = true;
          changeModeButton.innerHTML = '<i class="fas fa-moon">';
        const newDiv = document.createElement('div');
        newDiv.className = 'stars';
        for(let i = 0; i < 30; i++){
          const tempDiv = document.createElement('div');
          tempDiv.className = 'star';
          newDiv.appendChild(tempDiv);
        }
        document.body.appendChild(newDiv);
      }
      else{
        isDarkMode = false;
        changeModeButton.innerHTML = '<i class="fas fa-sun">';
        const starDiv = document.querySelectorAll('.stars');
        starDiv.forEach(element => {
          element.remove();
        });
      }
      });
      
    });
    
  </script>

</body>
</html>